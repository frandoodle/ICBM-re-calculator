mutate(soc_tha_control = filter(cur_data(),
treatment_number==1,
f_control == min(cur_data()$f_control))$soc_tha,
soc_tha_10cm_control = soc_tha_control*(10/(filter(cur_data(),treatment_number==1,f_control == min(f_control))$f_control_depth))) %>%
# Compute the total measured depth (only including depths < 20cm) for each treatment, use this to estimate 0-20cm SOC
group_by(location_name, treatment_name, year_name) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(lowest_depth = -sum(-soil_depth_max_cm[soil_depth_max_cm<20], soil_depth_min_cm[soil_depth_max_cm<20]),
soc_lowestdepth_dynamic = sum(soc_tha[soil_depth_max_cm<20]),
soc_30cm_naive = mean(soc_tha_30cm),
soc_10cm_control = mean(soc_tha_10cm_control)) %>%
mutate(soc_20cm_dynamic = soc_lowestdepth_dynamic*(20/lowest_depth),
soc_20cm_naive = soc_30cm_naive*(20/30),
soc_30cm_dynamic_control = soc_20cm_dynamic + soc_10cm_control,
soc_30cm_naive_control = soc_20cm_naive + soc_10cm_control)
site_data_corrected
View(site_data_corrected)
site_data_corrected <- site_data_all %>%
select(location_name, treatment_number,treatment_name, plot_id, year_name, replication_number, soil_depth, soil_depth_min_cm, soil_depth_max_cm,
soc_tha, soc_tha_30cm, initial_soc_tha, initial_soc_year) %>%
filter(!is.na(soc_tha)) %>%
filter(!is.na(treatment_number)) %>%
# Get the mean for field_name, replication_number, and block
group_by(location_name, year_name, treatment_number, treatment_name, plot_id, soil_depth_min_cm, soil_depth_max_cm) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(across(soc_tha:initial_soc_tha, mean)) %>%
# Find bottom 10cm of soil profile SOC using control from that treatment
mutate(f_control = (abs(20-soil_depth_min_cm) +  abs(30-soil_depth_max_cm)),
f_control_depth = soil_depth_max_cm - soil_depth_min_cm) %>%
group_by(location_name, year_name) %>%
mutate(soc_tha_control = filter(cur_data(),
treatment_number==1,
f_control == min(cur_data()$f_control))$soc_tha,
soc_tha_10cm_control = soc_tha_control*(10/(filter(cur_data(),treatment_number==1,f_control == min(f_control))$f_control_depth))) %>%
# Compute the total measured depth (only including depths < 20cm) for each treatment, use this to estimate 0-20cm SOC
group_by(location_name, treatment_name, year_name) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(lowest_depth = -sum(-soil_depth_max_cm[soil_depth_max_cm<20], soil_depth_min_cm[soil_depth_max_cm<20]),
soc_lowestdepth_dynamic = sum(soc_tha[soil_depth_max_cm<20]),
soc_30cm_naive = mean(soc_tha_30cm),
soc_10cm_control = mean(soc_tha_10cm_control)) %>%
mutate(soc_20cm_dynamic = soc_lowestdepth_dynamic*(20/lowest_depth),
soc_20cm_naive = soc_30cm_naive*(20/30),
soc_30cm_dynamic_control = soc_20cm_dynamic + soc_10cm_control,
soc_30cm_naive_control = soc_20cm_naive + soc_10cm_control)
site_data_corrected <- site_data_all %>%
select(location_name, treatment_number,treatment_name, plot_id, year_name, replication_number, soil_depth, soil_depth_min_cm, soil_depth_max_cm,
soc_tha, soc_tha_30cm, initial_soc_tha, initial_soc_year) %>%
filter(!is.na(soc_tha)) %>%
filter(!is.na(treatment_number)) %>%
# Get the mean for field_name, replication_number, and block
group_by(location_name, year_name, treatment_number, treatment_name, plot_id, soil_depth_min_cm, soil_depth_max_cm) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(across(soc_tha:initial_soc_tha, mean)) %>%
# Find bottom 10cm of soil profile SOC using control from that treatment
mutate(f_control = (abs(20-soil_depth_min_cm) +  abs(30-soil_depth_max_cm)),
f_control_depth = soil_depth_max_cm - soil_depth_min_cm) %>%
group_by(location_name, year_name)
nn <- site_data_corrected %>%
group_split
nn[[7]]
site_data_all <- readr::read_csv(here("data/all_experiments_dummy.csv")) %>%
mutate(soil_depth = paste0(soil_depth_min_cm,"-",soil_depth_max_cm))
site_data_corrected <- site_data_all %>%
select(location_name, experiment_name, treatment_number,treatment_name, year_name, replication_number, soil_depth, soil_depth_min_cm, soil_depth_max_cm,
soc_tha, soc_tha_30cm, initial_soc_tha, initial_soc_year) %>%
filter(!is.na(soc_tha)) %>%
filter(!is.na(treatment_number)) %>%
# Get the mean for field_name, replication_number, and block
group_by(location_name, experiment_name, year_name, treatment_number, treatment_name, soil_depth_min_cm, soil_depth_max_cm) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(across(soc_tha:initial_soc_tha, mean)) %>%
# Find bottom 10cm of soil profile SOC using control from that treatment
mutate(f_control = (abs(20-soil_depth_min_cm) +  abs(30-soil_depth_max_cm)),
f_control_depth = soil_depth_max_cm - soil_depth_min_cm) %>%
group_by(location_name, experiment_name, year_name)
site_data_corrected <- site_data_all %>%
select(location_name, experiment_name, treatment_number,treatment_name, year_name, replication_number, soil_depth, soil_depth_min_cm, soil_depth_max_cm,
soc_tha, soc_tha_30cm, initial_soc_tha, initial_soc_year) %>%
filter(!is.na(soc_tha)) %>%
filter(!is.na(treatment_number)) %>%
# Get the mean for field_name, replication_number, and block
group_by(location_name, experiment_name, year_name, treatment_number, treatment_name, soil_depth_min_cm, soil_depth_max_cm) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(across(soc_tha:initial_soc_tha, mean)) %>%
# Find bottom 10cm of soil profile SOC using control from that treatment
mutate(f_control = (abs(20-soil_depth_min_cm) +  abs(30-soil_depth_max_cm)),
f_control_depth = soil_depth_max_cm - soil_depth_min_cm) %>%
group_by(location_name, experiment_name, year_name) %>%
mutate(soc_tha_control = filter(cur_data(),
treatment_number==1,
f_control == min(cur_data()$f_control))$soc_tha,
soc_tha_10cm_control = soc_tha_control*(10/(filter(cur_data(),treatment_number==1,f_control == min(f_control))$f_control_depth))) %>%
# Compute the total measured depth (only including depths < 20cm) for each treatment, use this to estimate 0-20cm SOC
group_by(location_name, treatment_name, year_name) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(lowest_depth = -sum(-soil_depth_max_cm[soil_depth_max_cm<20], soil_depth_min_cm[soil_depth_max_cm<20]),
soc_lowestdepth_dynamic = sum(soc_tha[soil_depth_max_cm<20]),
soc_30cm_naive = mean(soc_tha_30cm),
soc_10cm_control = mean(soc_tha_10cm_control)) %>%
mutate(soc_20cm_dynamic = soc_lowestdepth_dynamic*(20/lowest_depth),
soc_20cm_naive = soc_30cm_naive*(20/30),
soc_30cm_dynamic_control = soc_20cm_dynamic + soc_10cm_control,
soc_30cm_naive_control = soc_20cm_naive + soc_10cm_control)
View(site_data_corrected)
site_data_corrected <- site_data_all %>%
select(location_name, experiment_name, treatment_number,treatment_name, year_name, replication_number, soil_depth, soil_depth_min_cm, soil_depth_max_cm,
soc_tha, soc_tha_30cm, initial_soc_tha, initial_soc_year) %>%
filter(!is.na(soc_tha)) %>%
filter(!is.na(treatment_number)) %>%
# Get the mean for field_name, replication_number, and block
group_by(location_name, experiment_name, year_name, treatment_number, treatment_name, soil_depth_min_cm, soil_depth_max_cm) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(across(soc_tha:initial_soc_tha, mean)) %>%
# Find bottom 10cm of soil profile SOC using control from that treatment
mutate(f_control = (abs(20-soil_depth_min_cm) +  abs(30-soil_depth_max_cm)),
f_control_depth = soil_depth_max_cm - soil_depth_min_cm) %>%
group_by(location_name, experiment_name, year_name) %>%
mutate(soc_tha_control = filter(cur_data(),
treatment_number==1,
f_control == min(cur_data()$f_control))$soc_tha,
soc_tha_10cm_control = soc_tha_control*(10/(filter(cur_data(),treatment_number==1,f_control == min(f_control))$f_control_depth))) %>%
# Compute the total measured depth (only including depths < 20cm) for each treatment, use this to estimate 0-20cm SOC
group_by(location_name, experiment_name, treatment_name, year_name) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(lowest_depth = -sum(-soil_depth_max_cm[soil_depth_max_cm<20], soil_depth_min_cm[soil_depth_max_cm<20]),
soc_lowestdepth_dynamic = sum(soc_tha[soil_depth_max_cm<20]),
soc_30cm_naive = mean(soc_tha_30cm),
soc_10cm_control = mean(soc_tha_10cm_control)) %>%
mutate(soc_20cm_dynamic = soc_lowestdepth_dynamic*(20/lowest_depth),
soc_20cm_naive = soc_30cm_naive*(20/30),
soc_30cm_dynamic_control = soc_20cm_dynamic + soc_10cm_control,
soc_30cm_naive_control = soc_20cm_naive + soc_10cm_control)
View(site_data_corrected)
site_data_corrected <- site_data_all %>%
select(location_name, experiment_name, treatment_number,treatment_name, year_name, replication_number, soil_depth, soil_depth_min_cm, soil_depth_max_cm,
soc_tha, soc_tha_30cm, initial_soc_tha, initial_soc_year) %>%
filter(!is.na(soc_tha)) %>%
# Get the mean for field_name, replication_number, and block
group_by(location_name, experiment_name, year_name, treatment_number, treatment_name, soil_depth_min_cm, soil_depth_max_cm) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(across(soc_tha:initial_soc_tha, mean)) %>%
# Find bottom 10cm of soil profile SOC using control from that treatment
mutate(f_control = (abs(20-soil_depth_min_cm) +  abs(30-soil_depth_max_cm)),
f_control_depth = soil_depth_max_cm - soil_depth_min_cm) %>%
group_by(location_name, experiment_name, year_name) %>%
mutate(soc_tha_control = filter(cur_data(),
treatment_number==1,
f_control == min(cur_data()$f_control))$soc_tha,
soc_tha_10cm_control = soc_tha_control*(10/(filter(cur_data(),treatment_number==1,f_control == min(f_control))$f_control_depth))) %>%
# Compute the total measured depth (only including depths < 20cm) for each treatment, use this to estimate 0-20cm SOC
group_by(location_name, experiment_name, treatment_name, year_name) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(lowest_depth = -sum(-soil_depth_max_cm[soil_depth_max_cm<20], soil_depth_min_cm[soil_depth_max_cm<20]),
soc_lowestdepth_dynamic = sum(soc_tha[soil_depth_max_cm<20]),
soc_30cm_naive = mean(soc_tha_30cm),
soc_10cm_control = mean(soc_tha_10cm_control)) %>%
mutate(soc_20cm_dynamic = soc_lowestdepth_dynamic*(20/lowest_depth),
soc_20cm_naive = soc_30cm_naive*(20/30),
soc_30cm_dynamic_control = soc_20cm_dynamic + soc_10cm_control,
soc_30cm_naive_control = soc_20cm_naive + soc_10cm_control)
View(site_data_corrected)
site_data_corrected <- site_data_all %>%
select(location_name, experiment_name, treatment_number,treatment_name, year_name, replication_number, soil_depth, soil_depth_min_cm, soil_depth_max_cm,
soc_tha, soc_tha_30cm, initial_soc_tha, initial_soc_year) %>%
filter(!is.na(soc_tha)) %>%
filter(!is.na(treatment_number)) %>%
# Get the mean for field_name, replication_number, and block
group_by(location_name, experiment_name, year_name, treatment_number, treatment_name, soil_depth_min_cm, soil_depth_max_cm) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(across(soc_tha:initial_soc_tha, mean)) %>%
# Find bottom 10cm of soil profile SOC using control from that treatment
mutate(f_control = (abs(20-soil_depth_min_cm) +  abs(30-soil_depth_max_cm)),
f_control_depth = soil_depth_max_cm - soil_depth_min_cm) %>%
group_by(location_name, experiment_name, year_name) %>%
mutate(soc_tha_control = filter(cur_data(),
treatment_number==1,
f_control == min(cur_data()$f_control))$soc_tha,
soc_tha_10cm_control = soc_tha_control*(10/(filter(cur_data(),treatment_number==1,f_control == min(f_control))$f_control_depth))) %>%
# Compute the total measured depth (only including depths < 20cm) for each treatment, use this to estimate 0-20cm SOC
group_by(location_name, experiment_name, treatment_name, year_name) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(lowest_depth = -sum(-soil_depth_max_cm[soil_depth_max_cm<20], soil_depth_min_cm[soil_depth_max_cm<20]),
soc_lowestdepth_dynamic = sum(soc_tha[soil_depth_max_cm<20]),
soc_30cm_naive = mean(soc_tha_30cm),
soc_10cm_control = mean(soc_tha_10cm_control))
View(site_data_corrected)
site_data_corrected <- site_data_all %>%
select(location_name, experiment_name, treatment_number,treatment_name, year_name, replication_number, soil_depth, soil_depth_min_cm, soil_depth_max_cm,
soc_tha, soc_tha_30cm, initial_soc_tha, initial_soc_year) %>%
filter(!is.na(soc_tha)) %>%
filter(!is.na(treatment_number)) %>%
# Get the mean for field_name, replication_number, and block
group_by(location_name, experiment_name, year_name, treatment_number, treatment_name, soil_depth_min_cm, soil_depth_max_cm) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(across(soc_tha:initial_soc_tha, mean)) %>%
# Find bottom 10cm of soil profile SOC using control from that treatment
mutate(f_control = (abs(20-soil_depth_min_cm) +  abs(30-soil_depth_max_cm)),
f_control_depth = soil_depth_max_cm - soil_depth_min_cm) %>%
group_by(location_name, experiment_name, year_name) %>%
mutate(soc_tha_control = filter(cur_data(),
treatment_number==1,
f_control == min(cur_data()$f_control))$soc_tha,
soc_tha_10cm_control = soc_tha_control*(10/(filter(cur_data(),treatment_number==1,f_control == min(f_control))$f_control_depth))) %>%
# Compute the total measured depth (only including depths < 20cm) for each treatment, use this to estimate 0-20cm SOC
group_by(location_name, experiment_name, treatment_name, year_name) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(lowest_depth = -sum(-soil_depth_max_cm[soil_depth_max_cm<=20], soil_depth_min_cm[soil_depth_max_cm<=20]),
soc_lowestdepth_dynamic = sum(soc_tha[soil_depth_max_cm<=20]),
soc_30cm_naive = mean(soc_tha_30cm),
soc_10cm_control = mean(soc_tha_10cm_control)) %>%
mutate(soc_20cm_dynamic = soc_lowestdepth_dynamic*(20/lowest_depth),
soc_20cm_naive = soc_30cm_naive*(20/30),
soc_30cm_dynamic_control = soc_20cm_dynamic + soc_10cm_control,
soc_30cm_naive_control = soc_20cm_naive + soc_10cm_control)
site_data_corrected <- site_data_all %>%
select(location_name, experiment_name, treatment_number,treatment_name, year_name, replication_number, soil_depth, soil_depth_min_cm, soil_depth_max_cm,
soc_tha, soc_tha_30cm, initial_soc_tha, initial_soc_year) %>%
filter(!is.na(soc_tha)) %>%
filter(!is.na(treatment_number)) %>%
# Get the mean for field_name, replication_number, and block
group_by(location_name, experiment_name, year_name, treatment_number, treatment_name, soil_depth_min_cm, soil_depth_max_cm) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(across(soc_tha:initial_soc_tha, mean)) %>%
# Find bottom 10cm of soil profile SOC using control from that treatment
mutate(f_control = (abs(20-soil_depth_min_cm) +  abs(30-soil_depth_max_cm)),
f_control_depth = soil_depth_max_cm - soil_depth_min_cm) %>%
group_by(location_name, experiment_name, year_name) %>%
mutate(soc_tha_control = filter(cur_data(),
treatment_number==1,
f_control == min(cur_data()$f_control))$soc_tha,
soc_tha_10cm_control = soc_tha_control*(10/(filter(cur_data(),treatment_number==1,f_control == min(f_control))$f_control_depth))) %>%
# Compute the total measured depth (only including depths < 20cm) for each treatment, use this to estimate 0-20cm SOC
group_by(location_name, experiment_name, treatment_name, year_name) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(lowest_depth = -sum(-soil_depth_max_cm[soil_depth_max_cm<=25], soil_depth_min_cm[soil_depth_max_cm<=25]),
soc_lowestdepth_dynamic = sum(soc_tha[soil_depth_max_cm<=25]),
soc_30cm_naive = mean(soc_tha_30cm),
soc_10cm_control = mean(soc_tha_10cm_control)) %>%
mutate(soc_20cm_dynamic = soc_lowestdepth_dynamic*(20/lowest_depth),
soc_20cm_naive = soc_30cm_naive*(20/30),
soc_30cm_dynamic_control = soc_20cm_dynamic + soc_10cm_control,
soc_30cm_naive_control = soc_20cm_naive + soc_10cm_control)
View(site_data_corrected)
zz <- c(1,2,3,4,5)
zz[zz<3]
zz<3
site_data_corrected <- site_data_all %>%
select(location_name, experiment_name, treatment_number,treatment_name, year_name, replication_number, soil_depth, soil_depth_min_cm, soil_depth_max_cm,
soc_tha, soc_tha_30cm, initial_soc_tha, initial_soc_year) %>%
filter(!is.na(soc_tha)) %>%
filter(!is.na(treatment_number)) %>%
# Get the mean for field_name, replication_number, and block
group_by(location_name, experiment_name, year_name, treatment_number, treatment_name, soil_depth_min_cm, soil_depth_max_cm) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(across(soc_tha:initial_soc_tha, mean)) %>%
# Find bottom 10cm of soil profile SOC using control from that treatment
mutate(f_control = (abs(20-soil_depth_min_cm) +  abs(30-soil_depth_max_cm)),
f_control_depth = soil_depth_max_cm - soil_depth_min_cm) %>%
group_by(location_name, experiment_name, year_name) %>%
mutate(soc_tha_control = filter(cur_data(),
treatment_number==1,
f_control == min(cur_data()$f_control))$soc_tha,
soc_tha_10cm_control = soc_tha_control*(10/(filter(cur_data(),treatment_number==1,f_control == min(f_control))$f_control_depth))) %>%
# Compute the total measured depth (only including depths < 20cm) for each treatment, use this to estimate 0-20cm SOC
group_by(location_name, experiment_name, treatment_name, year_name) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(lowest_depth = -sum(-soil_depth_max_cm[soil_depth_max_cm<=20], soil_depth_min_cm[soil_depth_max_cm<=20]),
soc_lowestdepth_dynamic = sum(soc_tha[soil_depth_max_cm<=20]),
soc_30cm_naive = mean(soc_tha_30cm),
soc_10cm_control = mean(soc_tha_10cm_control)) %>%
mutate(soc_20cm_dynamic = soc_lowestdepth_dynamic*(20/lowest_depth),
soc_20cm_naive = soc_30cm_naive*(20/30),
soc_30cm_dynamic_control = soc_20cm_dynamic + soc_10cm_control,
soc_30cm_naive_control = soc_20cm_naive + soc_10cm_control)
site_data_corrected <- site_data_all %>%
select(location_name, experiment_name, treatment_number,treatment_name, year_name, replication_number, soil_depth, soil_depth_min_cm, soil_depth_max_cm,
soc_tha, soc_tha_30cm, initial_soc_tha, initial_soc_year) %>%
filter(!is.na(soc_tha)) %>%
# Get the mean for field_name, replication_number, and block
group_by(location_name, experiment_name, year_name, treatment_number, treatment_name, soil_depth_min_cm, soil_depth_max_cm) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(across(soc_tha:initial_soc_tha, mean)) %>%
# Find bottom 10cm of soil profile SOC using control from that treatment
mutate(f_control = (abs(20-soil_depth_min_cm) +  abs(30-soil_depth_max_cm)),
f_control_depth = soil_depth_max_cm - soil_depth_min_cm) %>%
group_by(location_name, experiment_name, year_name) %>%
mutate(soc_tha_control = filter(cur_data(),
treatment_number==1,
f_control == min(cur_data()$f_control))$soc_tha,
soc_tha_10cm_control = soc_tha_control*(10/(filter(cur_data(),treatment_number==1,f_control == min(f_control))$f_control_depth))) %>%
# Compute the total measured depth (only including depths < 20cm) for each treatment, use this to estimate 0-20cm SOC
group_by(location_name, experiment_name, treatment_name, year_name) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(lowest_depth = -sum(-soil_depth_max_cm[soil_depth_max_cm<=20], soil_depth_min_cm[soil_depth_max_cm<=20]),
soc_lowestdepth_dynamic = sum(soc_tha[soil_depth_max_cm<=20]),
soc_30cm_naive = mean(soc_tha_30cm),
soc_10cm_control = mean(soc_tha_10cm_control)) %>%
mutate(soc_20cm_dynamic = soc_lowestdepth_dynamic*(20/lowest_depth),
soc_20cm_naive = soc_30cm_naive*(20/30),
soc_30cm_dynamic_control = soc_20cm_dynamic + soc_10cm_control,
soc_30cm_naive_control = soc_20cm_naive + soc_10cm_control)
View(site_data_corrected)
vv <- site_data_all %>% filter(location_name=="Scott")
View(vv)
vv$treatment_name
unique(vv$treatment_name)
site_data_all <- readr::read_csv(here("data/all_experiments_dummy.csv")) %>%
mutate(soil_depth = paste0(soil_depth_min_cm,"-",soil_depth_max_cm))
site_data_corrected <- site_data_all %>%
select(location_name, experiment_name, treatment_number,treatment_name, year_name, replication_number, soil_depth, soil_depth_min_cm, soil_depth_max_cm,
soc_tha, soc_tha_30cm, initial_soc_tha, initial_soc_year) %>%
filter(!is.na(soc_tha)) %>%
# Get the mean for field_name, replication_number, and block
group_by(location_name, experiment_name, year_name, treatment_number, treatment_name, soil_depth_min_cm, soil_depth_max_cm) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(across(soc_tha:initial_soc_tha, mean)) %>%
# Find bottom 10cm of soil profile SOC using control from that treatment
mutate(f_control = (abs(20-soil_depth_min_cm) +  abs(30-soil_depth_max_cm)),
f_control_depth = soil_depth_max_cm - soil_depth_min_cm) %>%
group_by(location_name, experiment_name, year_name) %>%
mutate(soc_tha_control = filter(cur_data(),
treatment_number==1,
f_control == min(cur_data()$f_control))$soc_tha,
soc_tha_10cm_control = soc_tha_control*(10/(filter(cur_data(),treatment_number==1,f_control == min(f_control))$f_control_depth))) %>%
# Compute the total measured depth (only including depths < 20cm) for each treatment, use this to estimate 0-20cm SOC
group_by(location_name, experiment_name, treatment_name, year_name) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(lowest_depth = -sum(-soil_depth_max_cm[soil_depth_max_cm<=20], soil_depth_min_cm[soil_depth_max_cm<=20]),
soc_lowestdepth_dynamic = sum(soc_tha[soil_depth_max_cm<=20]),
soc_30cm_naive = mean(soc_tha_30cm),
soc_10cm_control = mean(soc_tha_10cm_control)) %>%
mutate(soc_20cm_dynamic = soc_lowestdepth_dynamic*(20/lowest_depth),
soc_20cm_naive = soc_30cm_naive*(20/30),
soc_30cm_dynamic_control = soc_20cm_dynamic + soc_10cm_control,
soc_30cm_naive_control = soc_20cm_naive + soc_10cm_control)
site_data_corrected <- site_data_all %>%
select(location_name, experiment_name, treatment_number,treatment_name, year_name, replication_number, soil_depth, soil_depth_min_cm, soil_depth_max_cm,
soc_tha, soc_tha_30cm, initial_soc_tha, initial_soc_year) %>%
filter(!is.na(soc_tha)) %>%
# Get the mean for field_name, replication_number, and block
group_by(location_name, experiment_name, year_name, treatment_number, treatment_name, soil_depth_min_cm, soil_depth_max_cm) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(across(soc_tha:initial_soc_tha, mean)) %>%
# Find bottom 10cm of soil profile SOC using control from that treatment
mutate(f_control = (abs(20-soil_depth_min_cm) +  abs(30-soil_depth_max_cm)),
f_control_depth = soil_depth_max_cm - soil_depth_min_cm) %>%
group_by(location_name, experiment_name, year_name)
nn <- site_data_corrected %>%
group_split
nn[[25]]
nn[[25]]
first(nn[[25]])
slice(nn[[25]])
slice(nn[[25]], 1)
mutate(soc_tha_control = ifelse(1 %in% cur_data()$treatment_number,
filter(cur_data(),
treatment_number==1,
f_control == min(cur_data()$f_control))$soc_tha,
slice(cur_data(),1)$soc_tha
),
soc_tha_10cm_control = soc_tha_control*(10/(filter(cur_data(),treatment_number==1,f_control == min(f_control))$f_control_depth))) %>%
# Compute the total measured depth (only including depths < 20cm) for each treatment, use this to estimate 0-20cm SOC
group_by(location_name, experiment_name, treatment_name, year_name) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(lowest_depth = -sum(-soil_depth_max_cm[soil_depth_max_cm<=20], soil_depth_min_cm[soil_depth_max_cm<=20]),
soc_lowestdepth_dynamic = sum(soc_tha[soil_depth_max_cm<=20]),
soc_30cm_naive = mean(soc_tha_30cm),
soc_10cm_control = mean(soc_tha_10cm_control)) %>%
mutate(soc_20cm_dynamic = soc_lowestdepth_dynamic*(20/lowest_depth),
soc_20cm_naive = soc_30cm_naive*(20/30),
soc_30cm_dynamic_control = soc_20cm_dynamic + soc_10cm_control,
soc_30cm_naive_control = soc_20cm_naive + soc_10cm_control)
mutate(soc_tha_control = ifelse(1 %in% cur_data()$treatment_number,
filter(cur_data(),
treatment_number==1,
f_control == min(cur_data()$f_control))$soc_tha,
soc_tha
),
soc_tha_10cm_control = soc_tha_control*(10/(filter(cur_data(),treatment_number==1,f_control == min(f_control))$f_control_depth))) %>%
# Compute the total measured depth (only including depths < 20cm) for each treatment, use this to estimate 0-20cm SOC
group_by(location_name, experiment_name, treatment_name, year_name) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(lowest_depth = -sum(-soil_depth_max_cm[soil_depth_max_cm<=20], soil_depth_min_cm[soil_depth_max_cm<=20]),
soc_lowestdepth_dynamic = sum(soc_tha[soil_depth_max_cm<=20]),
soc_30cm_naive = mean(soc_tha_30cm),
soc_10cm_control = mean(soc_tha_10cm_control)) %>%
mutate(soc_20cm_dynamic = soc_lowestdepth_dynamic*(20/lowest_depth),
soc_20cm_naive = soc_30cm_naive*(20/30),
soc_30cm_dynamic_control = soc_20cm_dynamic + soc_10cm_control,
soc_30cm_naive_control = soc_20cm_naive + soc_10cm_control)
mutate(soc_tha_control = ifelse(1 %in% .data$treatment_number,
filter(cur_data(),
treatment_number==1,
f_control == min(cur_data()$f_control))$soc_tha,
slice(cur_data(),1)$soc_tha
),
soc_tha_10cm_control = soc_tha_control*(10/(filter(cur_data(),treatment_number==1,f_control == min(f_control))$f_control_depth))) %>%
# Compute the total measured depth (only including depths < 20cm) for each treatment, use this to estimate 0-20cm SOC
group_by(location_name, experiment_name, treatment_name, year_name) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(lowest_depth = -sum(-soil_depth_max_cm[soil_depth_max_cm<=20], soil_depth_min_cm[soil_depth_max_cm<=20]),
soc_lowestdepth_dynamic = sum(soc_tha[soil_depth_max_cm<=20]),
soc_30cm_naive = mean(soc_tha_30cm),
soc_10cm_control = mean(soc_tha_10cm_control)) %>%
mutate(soc_20cm_dynamic = soc_lowestdepth_dynamic*(20/lowest_depth),
soc_20cm_naive = soc_30cm_naive*(20/30),
soc_30cm_dynamic_control = soc_20cm_dynamic + soc_10cm_control,
soc_30cm_naive_control = soc_20cm_naive + soc_10cm_control)
mutate(soc_tha_control = ifelse(1 %in% treatment_number,
filter(cur_data(),
treatment_number==1,
f_control == min(cur_data()$f_control))$soc_tha,
slice(cur_data(),1)$soc_tha
),
soc_tha_10cm_control = soc_tha_control*(10/(filter(cur_data(),treatment_number==1,f_control == min(f_control))$f_control_depth))) %>%
# Compute the total measured depth (only including depths < 20cm) for each treatment, use this to estimate 0-20cm SOC
group_by(location_name, experiment_name, treatment_name, year_name) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(lowest_depth = -sum(-soil_depth_max_cm[soil_depth_max_cm<=20], soil_depth_min_cm[soil_depth_max_cm<=20]),
soc_lowestdepth_dynamic = sum(soc_tha[soil_depth_max_cm<=20]),
soc_30cm_naive = mean(soc_tha_30cm),
soc_10cm_control = mean(soc_tha_10cm_control)) %>%
mutate(soc_20cm_dynamic = soc_lowestdepth_dynamic*(20/lowest_depth),
soc_20cm_naive = soc_30cm_naive*(20/30),
soc_30cm_dynamic_control = soc_20cm_dynamic + soc_10cm_control,
soc_30cm_naive_control = soc_20cm_naive + soc_10cm_control)
site_data_corrected <- site_data_all %>%
select(location_name, experiment_name, treatment_number,treatment_name, year_name, replication_number, soil_depth, soil_depth_min_cm, soil_depth_max_cm,
soc_tha, soc_tha_30cm, initial_soc_tha, initial_soc_year) %>%
filter(!is.na(soc_tha)) %>%
# Get the mean for field_name, replication_number, and block
group_by(location_name, experiment_name, year_name, treatment_number, treatment_name, soil_depth_min_cm, soil_depth_max_cm) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(across(soc_tha:initial_soc_tha, mean)) %>%
# Find bottom 10cm of soil profile SOC using control from that treatment
mutate(f_control = (abs(20-soil_depth_min_cm) +  abs(30-soil_depth_max_cm)),
f_control_depth = soil_depth_max_cm - soil_depth_min_cm) %>%
group_by(location_name, experiment_name, year_name) %>%
mutate(soc_tha_control = ifelse(1 %in% treatment_number,
filter(cur_data(),
treatment_number==1,
f_control == min(cur_data()$f_control))$soc_tha,
slice(cur_data(),1)$soc_tha
),
soc_tha_10cm_control = soc_tha_control*(10/(filter(cur_data(),treatment_number==1,f_control == min(f_control))$f_control_depth))) %>%
# Compute the total measured depth (only including depths < 20cm) for each treatment, use this to estimate 0-20cm SOC
group_by(location_name, experiment_name, treatment_name, year_name) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(lowest_depth = -sum(-soil_depth_max_cm[soil_depth_max_cm<=20], soil_depth_min_cm[soil_depth_max_cm<=20]),
soc_lowestdepth_dynamic = sum(soc_tha[soil_depth_max_cm<=20]),
soc_30cm_naive = mean(soc_tha_30cm),
soc_10cm_control = mean(soc_tha_10cm_control)) %>%
mutate(soc_20cm_dynamic = soc_lowestdepth_dynamic*(20/lowest_depth),
soc_20cm_naive = soc_30cm_naive*(20/30),
soc_30cm_dynamic_control = soc_20cm_dynamic + soc_10cm_control,
soc_30cm_naive_control = soc_20cm_naive + soc_10cm_control)
site_data_corrected <- site_data_all %>%
select(location_name, experiment_name, treatment_number,treatment_name, year_name, replication_number, soil_depth, soil_depth_min_cm, soil_depth_max_cm,
soc_tha, soc_tha_30cm, initial_soc_tha, initial_soc_year) %>%
filter(!is.na(soc_tha)) %>%
# Get the mean for field_name, replication_number, and block
group_by(location_name, experiment_name, year_name, treatment_number, treatment_name, soil_depth_min_cm, soil_depth_max_cm) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(across(soc_tha:initial_soc_tha, mean)) %>%
# Find bottom 10cm of soil profile SOC using control from that treatment
mutate(f_control = (abs(20-soil_depth_min_cm) +  abs(30-soil_depth_max_cm)),
f_control_depth = soil_depth_max_cm - soil_depth_min_cm) %>%
group_by(location_name, experiment_name, year_name) %>%
mutate(soc_tha_control = ifelse(1 %in% treatment_number,
filter(cur_data(),
treatment_number==1,
f_control == min(cur_data()$f_control))$soc_tha,
slice(cur_data(),1)$soc_tha
))
nn <- site_data_corrected %>%
group_split
nn[[25]]
site_data_corrected <- site_data_all %>%
select(location_name, experiment_name, treatment_number,treatment_name, year_name, replication_number, soil_depth, soil_depth_min_cm, soil_depth_max_cm,
soc_tha, soc_tha_30cm, initial_soc_tha, initial_soc_year) %>%
filter(!is.na(soc_tha)) %>%
# Get the mean for field_name, replication_number, and block
group_by(location_name, experiment_name, year_name, treatment_number, treatment_name, soil_depth_min_cm, soil_depth_max_cm) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(across(soc_tha:initial_soc_tha, mean)) %>%
# Find bottom 10cm of soil profile SOC using control from that treatment
mutate(f_control = (abs(20-soil_depth_min_cm) +  abs(30-soil_depth_max_cm)),
f_control_depth = soil_depth_max_cm - soil_depth_min_cm) %>%
group_by(location_name, experiment_name, year_name) %>%
mutate(soc_tha_control = ifelse(1 %in% treatment_number,
filter(cur_data(),
treatment_number==1,
f_control == min(cur_data()$f_control))$soc_tha,
slice(cur_data(),1)$soc_tha),
soc_tha_10cm_control = ifelse(1 %in% treatment_number,
soc_tha_control*(10/(filter(cur_data(),
treatment_number==1,
f_control == min(f_control))$f_control_depth)),
slice(cur_data(),1)$f_control_depth)) %>%
# Compute the total measured depth (only including depths < 20cm) for each treatment, use this to estimate 0-20cm SOC
group_by(location_name, experiment_name, treatment_name, year_name) %>%
group_by(.add=T, initial_soc_year) %>%
summarise(lowest_depth = -sum(-soil_depth_max_cm[soil_depth_max_cm<=20], soil_depth_min_cm[soil_depth_max_cm<=20]),
soc_lowestdepth_dynamic = sum(soc_tha[soil_depth_max_cm<=20]),
soc_30cm_naive = mean(soc_tha_30cm),
soc_10cm_control = mean(soc_tha_10cm_control)) %>%
mutate(soc_20cm_dynamic = soc_lowestdepth_dynamic*(20/lowest_depth),
soc_20cm_naive = soc_30cm_naive*(20/30),
soc_30cm_dynamic_control = soc_20cm_dynamic + soc_10cm_control,
soc_30cm_naive_control = soc_20cm_naive + soc_10cm_control)
View(site_data_corrected)
