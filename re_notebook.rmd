---
title: "ICBM r_e calculator"
author: "Francis Durnin-Vermette"
date: "2022/10/31"
output:
  html_document:
    df_print: paged
bibliography: re.bib
editor_options:
  chunk_output_type: inline
---

```{r include=FALSE}
library(ggplot2)
library(knitr)
library(dplyr)
library(geojson)
library(tibble)
library(purrr)
library(stringr)

source("re_functions.r")
```

## Climate data
We use the monthly climate normals that are shipped with Holos V4 in order to make our first calculations.
To use these, we need to specify an SLC polygon.
We arbitrarily choose SLC poly #1001009 for this.
```{r}
slc = 1001009
climate_test_norms1 <- readr::read_csv("climate/climateNorms_by_poly_1980_2010.csv") %>%
	filter(SLC == slc)
climate_test_norms1 %>%
	kable(caption="Climate normals for SLC polygon 1001009 for the period 1980 - 2010.")
```

## Green area index (GAI) dynamics

For our first test, let's say that it's julian day 150, and our crop is annual with Yield = 3000.
```{r}
JulianDay = 150
perennial = FALSE
Yield = 3000
```

### Eq. 2.2.1-1 through Eq. 2.2.1-3
```{r}
GAI_return <- calculateGAI(JulianDay = JulianDay,
						 Yield = Yield,
						 perennial = perennial)
GAI_return
```

Where
GAImax is Maximum amplitude of green area index, 
Yield is Crop yield (kg dry matter ha-1, database default or user specific),
MidSeason is Median day of growing season (Julian day),
EmergenceDay is Day of crop emergence (Julian day),
RipeningDay is Day of crop ripening (Julian day),
GAI is Green area index,
JulianDay is Day (Julian day), and
Variance is Width of distribution function.

## Water content at wilting point and field capacity

```{r}
SoilOrganicC_Percent = 12
ClayContent = 0.05
SandContent = 0.20
```

### Eq. 2.2.1-4 through Eq. 2.2.1-10
```{r}
WaterContent_return <- calculateWaterContent(SoilOrganicC_Percent = SoilOrganicC_Percent,
											ClayContent = ClayContent,
											SandContent = SandContent)
WaterContent_return
```

Where
OrgCfactor is Organic carbon factor,
SoilOrganicCPercent is Percentage of organic carbon in soil, by weight (%, SLC data table),
Clayfactor is Clay factor,
ClayContent is Proportion of clay in soil (SLC data table),
Sandfactor is Sand factor,
SandContent is Proportion of sand in soil (SLC data table),
WiltingPointPercent is Water content at wilting point (%),
WiltingPoint is Proportion of water content at wilting point (mm3 mm-3),
FieldCapacityPercent is Water content at field capacity (%), and
FieldCapacity is Proportion of water at field capacity (mm3 mm-3).




<!-- Test weather data is from the NASA POWER database for a latitude and longitude approximately equal to the location of Ottawa Central Experimental Farm (45.3875035,-75.7113529 according to google maps) -->
<!-- ```{r} -->
<!-- climate_test_wheat1 <- readr::read_file("nasa_climate_data_lat_45.0024867523983_long_-74.9998855590822") %>% -->
<!-- 	as.geojson -->
<!-- zz <- tibble(climate_test_wheat1) -->
<!-- geo_pretty(climate_test_wheat1) -->
<!-- ``` -->

# Holos test r_e results

<!-- ```{r results = "asis"} -->
<!-- results_test_wheat1 <- readr::read_csv("wheat1.csv", skip=1) -->

<!-- table_test_wheat1 <- results_test_wheat1%>% -->
<!-- 	select(Farm, Field, Year, Crop, `Yield (kg ha^-1)`, `Moisture content (%)`, `Tillage type`, -->
<!-- 				 `Climate Factor (re_crop)`, `Tillage Factor (r_c)`, `Management factor (r_e)`) %>% -->
<!-- 	kable(caption="Holos results for the wheat1 test farm.") -->
<!-- table_test_wheat1 -->
<!-- ``` -->


# References
